C51 COMPILER V9.01   MAIN                                                                  11/26/2014 20:38:00 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg51.h>
   2          #include <intrins.h>
   3          #include <sys\sys.h>
   4          #include <lcd\lcd.h>
   5          #include <font\font.h>
   6          #include <touch\touch.h>
   7          /* 
   8          代码测试环境:单片机STC12LE5A60S2,晶振33M  单片机工作电压3.3V
   9          程序默认IO连接方式：
  10          sbit LCD_CS     =P0^0;     //片选       
  11          sbit LCD_DC     =P0^2;    //数据/命令切换
  12          sbit LCD_SDI    =P1^5;    //数据
  13          sbit LCD_SCK    =P1^7;    //时钟
  14          sbit LCD_REST   =P0^1;    //复位  
  15          触摸功能连接方式：(不使用触摸可不连接)
  16          T_CLK-P1^7;  T_CS-P1^4;  T_DIN-P3^0;  T_OUT-P3^1;  T_IRQ-P3^4;
  17          */              
  18          sbit key1=P3^2;
  19          sbit key2=P3^3;
  20          sbit key3=P3^4;
  21          u8 ref=0;//刷新显示
  22          
  23          u8 jiance() //检测触摸和按键
  24          {
  25   1              if (tpstate()==0) //如果触摸按下，则进入绘图程序
  26   1               {
  27   2                      LCD_Clear(WHITE); //清屏
  28   2                      BACK_COLOR=WHITE;
  29   2                      POINT_COLOR=RED;
  30   2                      point();
  31   2                      return 1;
  32   2               }      
  33   1              if(key1==0)     //如果按键1按下,进入校准程序 
  34   1                 {
  35   2                      Touch_Adjust();//校准
  36   2                      return 1;
  37   2                 }
  38   1               if(key2==0)    //三色刷屏
  39   1                 {
  40   2                       LCD_Clear(RED);
  41   2                       delayms(3000);
  42   2                       LCD_Clear(GREEN);
  43   2                       delayms(3000);
  44   2                       LCD_Clear(BLUE);
  45   2                       delayms(3000);
  46   2                       return 1;
  47   2                 }
  48   1                 return 0;
  49   1      }
  50          void xianshi()//显示信息
  51          {   
  52   1              u16 lx,ly;
  53   1              BACK_COLOR=WHITE;
  54   1              POINT_COLOR=RED;        
  55   1              //显示32*32汉字
C51 COMPILER V9.01   MAIN                                                                  11/26/2014 20:38:00 PAGE 2   

  56   1              showhanzi32(0,0,0);      //淘
  57   1              showhanzi32(40,0,1); //晶
  58   1              showhanzi32(80,0,2); //驰
  59   1              //显示16*16汉字
  60   1              showhanzi16(0,35,0);      //专
  61   1              showhanzi16(20,35,1);     //注
  62   1              showhanzi16(40,35,2);     //显
  63   1              showhanzi16(60,35,3);     //示
  64   1              showhanzi16(80,35,4);     //方
  65   1              showhanzi16(100,35,5);    //案
  66   1          LCD_ShowString(0,55,"2.8 TFT SPI 240*320");
  67   1              lx=0;ly=75;                     
  68   1              LCD_ShowString(lx,ly,"VX:");lx+=40;LCD_ShowNum(lx,ly,vx,5);                                     
  69   1              lx+=60;
  70   1              LCD_ShowString(lx,ly,"Vy:");lx+=40;LCD_ShowNum(lx,ly,vy,5);                                     
  71   1              lx=0;ly=95; 
  72   1              LCD_ShowString(lx,ly,"CHX:");lx+=40;LCD_ShowNum(lx,ly,chx,5);                                   
  73   1              lx+=60; 
  74   1              LCD_ShowString(lx,ly,"CHY:");lx+=40;LCD_ShowNum(lx,ly,chy,5);
  75   1      }
  76          void showimage() //显示40*40图片
  77          {
  78   1              int i,j,k; 
  79   1              LCD_Clear(WHITE); //清屏  
  80   1              xianshi(); //显示信息
  81   1              for(k=3;k<8;k++)
  82   1              {
  83   2                      for(j=0;j<6;j++)
  84   2                      {       
  85   3                              Address_set(40*j,40*k,40*j+39,40*k+39);         //坐标设置
  86   3                          for(i=0;i<1600;i++)
  87   3                               {      
  88   4                                       if(jiance()) //检测触摸和按键
  89   4                                       {      
  90   5                                              ref=1;
  91   5                                              return; 
  92   5                                       }              
  93   4                                       LCD_WR_DATA8(image[i*2+1]);     
  94   4                                       LCD_WR_DATA8(image[i*2]);                              
  95   4                               }      
  96   3                       }
  97   2              }
  98   1              ref=0;                          
  99   1      }
 100          main()
 101          { 
 102   1              spistar()  ;//模拟SPI初始化
 103   1              Lcd_Init();   //tft初始化
 104   1              LCD_Clear(WHITE); //清屏
 105   1              BACK_COLOR=BLACK;;POINT_COLOR=WHITE; 
 106   1          showimage(); //显示40*40图片
 107   1      
 108   1              while(1)
 109   1              {
 110   2                  if(jiance()) //检测触摸和按键
 111   2                {     
 112   3                      showimage(); //显示40*40图片
 113   3                }
 114   2                if(ref){showimage();} //显示40*40图片
 115   2      
 116   2          }
 117   1      
C51 COMPILER V9.01   MAIN                                                                  11/26/2014 20:38:00 PAGE 3   

 118   1      
 119   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    924    ----
   CONSTANT SIZE    =     38    ----
   XDATA SIZE       =      1      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
